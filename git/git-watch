#!/bin/bash

if [ -z `which tmux` ]
then
	echo 'require tmux';
	exit 1;
fi

if [ -z `which watch` ]
then
	echo 'require watch';
	exit 1;
fi

if [ -z `which deno` ]
then
	echo 'require deno';
	exit 1;
fi

if [ -z `which fish` ]
then
	shell='bash';
else
	shell='fish';
fi

if [ -z $TMUX ]
then
	tmux new-session $shell -C "git watch $@";
	
	exit 0;
fi

case $1 in
	conflict)
		tmux split-window -h -p20 watching --grep='^U' git -c color.status=always s;
		tmux select-pane -t0;
	;;
	*)
		tmux split-window -h -p50 watching git -c color.status=always s;
		tmux split-window -v -p60 watching git reflog --color=always;
		tmux split-window -h -p50 watching git branch -a --color=always;
		tmux select-pane -t0;
		tmux split-window -v -p80 -b watching git tree --color=always;
		tmux select-pane -t1;
	;;
esac

clear;
